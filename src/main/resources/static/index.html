<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pool Shot Clock Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
  body {
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #0f2027;
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 2rem;
  }

  h1 { text-align: center; margin-bottom: 2rem; }

  .game-list { display: flex; flex-direction: column; gap: 1rem; width: 100%; max-width: 600px; }
  .game-item { display: flex; justify-content: space-between; align-items: center; background: #203a43; padding: 1rem; border-radius: 8px; }
  .game-item button { margin-left: 0.5rem; padding: 0.5rem 1rem; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
  .view-btn { background: #28a745; color: white; }
  .control-btn { background: #007bff; color: white; }
  .delete-btn { background: #dc3545; color: white; }
  .create-form { margin-bottom: 2rem; display: flex; gap: 0.5rem; }
  input[type=text] { padding: 0.5rem; border-radius: 6px; border: none; flex: 1; }
  button.create { background: #ffc107; color: #000; font-weight: bold; }
</style>
</head>
<body>

<h1>Pool Shot Clock Dashboard</h1>

<!-- Create Game Form -->
<form class="create-form" id="createForm">
  <input type="text" id="newGameId" placeholder="New Game ID" required>
  <button type="submit" class="create">Create Game</button>
</form>

<!-- Game List -->
<div class="game-list" id="gameList"></div>

<script>
const MASTER_KEY = "MASTER123"; // Your master key

function fetchGames() {
  fetch('/clock/list')
    .then(res => res.json())
    .then(games => {
      const list = document.getElementById('gameList');
      list.innerHTML = '';
      games.forEach(game => {
        const div = document.createElement('div');
        div.className = 'game-item';
        div.innerHTML = `
          <span>${game.gameId}</span>
          <div>
            <button class="view-btn" onclick="window.open('game.html?gameId=${game.gameId}', '_blank')">View</button>
            <button class="control-btn" onclick="controlGame('${game.gameId}')">Control</button>
            <button class="delete-btn" onclick="deleteGame('${game.gameId}')">Delete</button>
          </div>
        `;
        list.appendChild(div);
      });
    });
}

// Prompt for control key to open control page
function controlGame(gameId) {
  const key = prompt("Enter control key for this game:");
  if (!key) return;
  window.open(`game.html?gameId=${gameId}&key=${key}`, '_blank');
}

// Delete a game with control key or master key
function deleteGame(gameId) {
  const key = prompt("Enter control key or master key to delete this game:");
  if (!key) return;

  fetch(`/clock/${gameId}/delete?key=${encodeURIComponent(key)}`, { method: "POST" })
    .then(res => res.json())
    .then(data => {
      alert(data.message);
      fetchGames();
    });
}

// Create new game
document.getElementById('createForm').addEventListener('submit', e => {
  e.preventDefault();
  const gameId = document.getElementById('newGameId').value.trim();
  if (!gameId) return;

  fetch(`/clock/create?gameId=${encodeURIComponent(gameId)}`, { method: "POST" })
    .then(res => res.json())
    .then(data => {
      if (data.error) {
        alert(data.error);
      } else {
        // Auto-redirect creator to control page with key
        window.location.href = `game.html?gameId=${data.gameId}&key=${data.key}`;
      }
    });
});

// Initial fetch of games
fetchGames();
</script>

</body>
</html>
